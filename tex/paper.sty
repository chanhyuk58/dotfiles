\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{paper}

% 1. ESSENTIAL LOGIC & FONTS
\usepackage{etoolbox}
\usepackage{xparse}
\input{glyphtounicode}
\pdfgentounicode=1
\usepackage[T1]{fontenc}
\usepackage[hyphens]{url}
\usepackage{setspace} \doublespacing
\usepackage{geometry}
\geometry{margin=1in, footskip=0.5in}

% Pandoc-friendly microtype loading
\@ifpackageloaded{microtype}{}{\usepackage[nopatch=footnote, final]{microtype}}

% 2. THE MATH STACK
\usepackage{amsmath, amsthm, mathtools, amssymb, dsfont, bm}
\usepackage[cal=euler,bb=fourier]{mathalpha}
\usepackage[italic,nolessnomore,noparenthesis,noplusnominus,noequal,nohbar]{mathastext}

% Correct spacing for specific math letters
\MTsetmathskips{f}{3mu}{0mu}\MTsetmathskips{y}{2mu}{0mu}
\MTsetmathskips{p}{2mu}{0mu}\MTsetmathskips{j}{2mu}{0mu}

% 3. THEOREM ENVIRONMENTS
\newtheoremstyle{paper}{}{}{\itshape}{}{\scshape}{.}{0.5em}{}
\theoremstyle{paper}
\newtheorem{theorem}{Theorem}
\newtheorem{proposition}{Proposition}
\newtheorem{lemma}{Lemma}
\newtheorem{corollary}{Corollary}
\newtheorem{definition}{Definition}
\newtheorem{assumption}{Assumption}
\newtheorem{remark}{Remark}
\renewcommand{\proofname}{\upshape\scshape proof}

% 4. FIGURES, TABLES, & CAPTIONS
\usepackage{graphicx, booktabs, rotating, multirow, caption, subcaption}
\makeatletter\g@addto@macro\@floatboxreset\centering\makeatother 
\renewcommand{\arraystretch}{1.1}
\captionsetup{labelsep=period, font=small}
\captionsetup[table]{position=top}
\captionsetup[subfigure]{labelformat=simple, labelsep=period}
\renewcommand{\thesubfigure}{\Alph{subfigure}}
\renewcommand{\tablename}{\textsc{table}}
\renewcommand{\figurename}{\textsc{figure}}

% 5. TITLES & SECTIONS
\usepackage{titling, titlesec}
\pretitle{\begin{center}\LARGE\bfseries} \posttitle{\end{center}\vskip 1em}
\preauthor{\begin{center}\large\scshape} \postauthor{\end{center}\vskip 0.5em}
\titleformat*{\section}{\Large\bfseries}
\titleformat*{\subsection}{\bfseries}
\titleformat{\paragraph}[runin]{\itshape}{}{}{}[.]
\titlelabel{\thetitle.\quad}
\renewcommand{\tamark}{} % Remove thanks marks

% 6. LISTS & BIBLIOGRAPHY
\usepackage{enumitem}
\setlist{nosep}
\setlist[itemize,1]{leftmargin=*,label=\color{gray}{\textbullet}}
\setlist[enumerate,1]{leftmargin=*,label=\color{gray}{\alph*.}}
% \setcitestyle{aysep={}}
% \renewcommand{\bibfont}{\small}

% 7. PROBABILITY & MEASURE THEORY SHORTCUTS
\newcommand{\R}{\mathbb{R}} 
\newcommand{\Q}{\mathbb{Q}}
\newcommand{\N}{\mathbb{N}}
\newcommand{\F}{\mathcal{F}} 
\newcommand{\B}{\mathcal{B}}
\newcommand{\Power}{\mathcal{P}}

% Sets, Vectors, and Matrices
\DeclarePairedDelimiterX{\setarg}[1]{\{}{\}}{#1}
\newcommand{\set}[1]{\setarg*{#1}}
\newcommand{\vect}[1]{\bm{#1}}
\newcommand{\matr}[1]{\bm{#1}}
\newcommand{\one}{\mathbf{1}}
\newcommand{\zero}{\mathbf{0}}
\newcommand{\eye}{\mathbf{I}}

% Parentheses Helper
\DeclarePairedDelimiterX{\parentheses}[1]{(}{)}{#1}
\DeclarePairedDelimiterX{\brackets}[1]{[}{]}{#1}
\DeclarePairedDelimiterX{\braces}[1]{\{}{\}}{#1}

% Expectation and Probability
\renewcommand{\P}[1]{\mathbb{P}\parentheses*{#1}}
\newcommand{\E}[1]{\mathbb{E}\brackets*{#1}}
\newcommand{\V}[1]{\Var\brackets*{#1}}
\newcommand{\indep}{\perp\!\!\!\perp}
\newcommand{\Ex}[2]{\mathbb{E}_{#1}\brackets*{#2}}
\newcommand{\Px}[2]{\mathbb{P}_{#1}\parentheses*{#2}}

% Conditional Version
\newcommand\given{\nonscript\mskip-\medmuskip\mid\nonscript\mskip-\medmuskip\allowbreak}
\newcommand{\Ec}[2]{\mathbb{E}\brackets*{#1 \given #2}}
\newcommand{\Pc}[2]{\mathbb{P}\parentheses*{#1 \given #2}}
\newcommand{\Exc}[3]{\mathbb{E}_{#1}\brackets*{#2 \given #3}}

% All other
\newcommand{\T}{^{\intercal}}
\DeclarePairedDelimiterX{\absarg}[1]{\lvert}{\rvert}{#1}
\newcommand{\abs}[1]{\absarg*{#1}}
\DeclarePairedDelimiterX{\normarg}[1]{\lVert}{\rVert}{#1}
\newcommand{\norm}[1]{\normarg*{#1}}
\newcommand{\ind}[1]{\mathds{1}\braces*{#1}}
\newcommand{\diff}{\mathrm{d}}
\newcommand{\as}{\text{a.s.}}
\newcommand{\toprob}{\xrightarrow{p}}
\newcommand{\todist}{\xrightarrow{d}}
\newcommand{\toas}{\xrightarrow{\text{a.s.}}}
\newcommand{\iid}{\overset{\text{i.i.d.}}{\sim}}
\DeclarePairedDelimiter{\ceil}{\lceil}{\rceil}
\DeclarePairedDelimiter{\floor}{\lfloor}{\rfloor}
\DeclarePairedDelimiter{\atarg}{.}{\vert}
\newcommand{\eval}[3]{\atarg*{#1}_{#2}^{#3}}

% 8. APPENDIX & HYPERLINKS
\newcommand{\setupappendix}{
    \setcounter{section}{0} \renewcommand{\thesection}{\Alph{section}}
    \counterwithin*{table}{section} \counterwithin*{figure}{section}
    \counterwithin*{equation}{section}
    \renewcommand{\thetable}{\thesection\arabic{table}}
    \renewcommand{\thefigure}{\thesection\arabic{figure}}
    \renewcommand{\theequation}{\thesection\arabic{equation}}
    \titleformat{\section}{\centering\large\bfseries}{Appendix \thesection.}{1em}{}
}

\usepackage[hidelinks]{hyperref}
\usepackage[capitalize,noabbrev]{cleveref}

\AtBeginDocument{\allowdisplaybreaks[1]\frenchspacing}
