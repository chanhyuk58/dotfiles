% ---- 1. Fonts & Character Management -----
\usefonttheme{professionalfonts}
\usepackage{sourcesanspro}
\usepackage{sourcecodepro}
\usepackage[T1]{fontenc}
\usepackage{url}

% Define semibold font series
\DeclareRobustCommand{\sbseries}{\fontseries{sb}\selectfont}
\DeclareTextFontCommand{\textsb}{\sbseries}

% Pandoc-friendly microtype loading
\@ifpackageloaded{microtype}{}{
  \usepackage[nopatch=footnote]{microtype}
}
\DisableLigatures[f]{encoding = *, family = * }

% ---- 2. Math Stack & Fonts -----
\usepackage{amsmath, amsthm, mathtools, dsfont}
\usepackage[cal=euler,bb=fourier]{mathalpha}
\usepackage{bm} % Bold math

% mathastext for consistency between text and math fonts
\usepackage[italic,nolessnomore,noparenthesis,noplusnominus,noequal,nohbar]{mathastext}
\MTsetmathskips{y}{2mu}{0mu}
\MTsetmathskips{j}{2mu}{0mu}

% ---- 3. Probability & Measure Theory ----
\newcommand\given{\nonscript\mskip-\medmuskip\delimsize\vert\nonscript\mskip-\medmuskip\allowbreak}

\DeclarePairedDelimiterX{\parentheses}[1]{(}{)}{#1}
\DeclarePairedDelimiterX{\brackets}[1]{[}{]}{#1}

\renewcommand{\P}[1]{\mathbb{P}\parentheses*{#1}}
\newcommand{\E}[1]{\mathbb{E}\brackets*{#1}}
\newcommand{\Ec}[2]{\mathbb{E}\brackets*{#1 \given #2} }
\newcommand{\Pc}[2]{\mathbb{P}\parentheses*{#1 \given #2} }

\DeclareMathOperator{\Var}{Var}
\newcommand{\V}[1]{\Var\brackets*{#1}}
\newcommand{\ind}[1]{\mathds{1}_{\{#1\}}}
\newcommand{\diff}{\mathrm{d}}
\newcommand{\R}{\mathbb{R}}

% Causal Inference Independence
\newcommand{\indep}{\mathrel{\perp\mskip-7mu\perp}}
\newcommand{\cindep}[3]{#1 \indep #2 \given #3}

% Vectors & Matrices
\newcommand{\vect}[1]{\bm{#1}}
\newcommand{\matr}[1]{\bm{#1}}
\newcommand{\vbeta}{\vect{\beta}}

% ---- 4. Beamer Theme & Layout ----
\usetheme{Boadilla}
\usecolortheme{seagull}
\setbeamercovered{transparent}
\setbeamertemplate{navigation symbols}{}

% Margins
\setbeamersize{text margin left=5mm,text margin right=5mm}
\usepackage[onehalfspacing]{setspace}

% Titles & Headers (The Lowercase Aesthetic)
\setbeamerfont{title}{size=\huge, series=\scshape}
\setbeamerfont{author}{size=\large}
\setbeamerfont{frametitle}{series=\scshape}
\setbeamertemplate{frametitle}{\vskip3mm\MakeLowercase{\insertframetitle}}
\setbeamertemplate{frametitle continuation}{[\insertcontinuationcount]}

% Colors
\colorlet{BlackGray}{black!85!}
\colorlet{DarkGray}{gray!60!}
\colorlet{LightGray}{gray!30!}

\setbeamercolor{title}{fg=BlackGray}
\setbeamercolor{frametitle}{fg=BlackGray}
\setbeamercolor{normal text}{fg=BlackGray}
\setbeamercolor{itemize item}{fg=DarkGray}
\setbeamercolor{block title}{fg=BlackGray,bg=LightGray}
\setbeamercolor{block body}{fg=BlackGray,bg=LightGray}

% ---- 5. Title Page Customization ----
\let\oldtitle\title
\renewcommand{\title}[1]{\oldtitle[]{\MakeLowercase{#1}\vspace{-7mm}\\\color{BlackGray}{\rule{\textwidth}{2pt}}}}

\defbeamertemplate*{title page}{customized}[1][]{
  \vskip0pt plus 1filll
  \usebeamerfont{title}\inserttitle\par
  \vskip0pt plus 1filll
  \usebeamerfont{author}\insertauthor\par
  \usebeamerfont{date}\insertdate\par
  \vspace{0.2in}
}

% ---- 6. Alerts (Fixed xparse syntax) ----
% Standard alert: \al<1>{text} or \al{text}
\NewDocumentCommand{\al}{d<> m}{\textcolor<#1>{red!80!black}{#2}}
\NewDocumentCommand{\alg}{d<> m}{\textcolor<#1>{green!50!black}{#2}}
\NewDocumentCommand{\alr}{d<> m}{\textcolor<#1>{red}{#2}}
\NewDocumentCommand{\alb}{d<> m}{\textcolor<#1>{blue!80!black}{#2}}

% ---- 7. Tables & Figures ----
\usepackage{booktabs, multirow, caption}
\captionsetup{labelformat=empty, size=normalsize}

% ---- 8. Shortcuts & Symbols ----
\newcommand{\up}{\textuparrow\,}
\newcommand{\down}{\textdownarrow\,}
\newcommand{\then}{$\rightsquigarrow\,$}
\newcommand{\so}{$\Rightarrow\,$}
\newcommand{\heading}[1]{{\LARGE\scshape\color{BlackGray}\MakeLowercase{#1}}}

% ---- 9. Citations ----
\usepackage[round]{natbib}
\definecolor{citecolor}{gray}{0.6}

% This ensures natbib works inside Beamer frames
\setbeamertemplate{bibliography item}{\insertbiblabel}

% Create a dedicated command for tiny, grayed out citations on slides
% Usage: \cite{Jones2020}
\renewcommand{\cite}[1]{{\color{citecolor}\tiny\citep{#1}}}
